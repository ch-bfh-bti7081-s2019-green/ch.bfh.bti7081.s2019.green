@startuml

class Person{
    String firstname
    String lastname
    String username
    LocalDate birthdate
    Contact contactData
}

Person "1" *-- "1" Contact : is reachable at

class Patient extends Person{
    Therapist therapist
    List<Person> emergencyContacts
    Optional<MoodDiary> diary
    List<Prescription> prescriptions
    Map<Prescription, Reminder> reminders
    List<Intake> intakes
}

Patient "*" *-- "*" Person : has
Patient "1" *-- "*" Prescription : has
Patient "1" *-- "*" Reminder : is reminded by
Patient "1" *-- "*" Intake : has taken

class Therapist extends Person{
    List<Patient> patients
    List<Prescription> prescriptions
}

Therapist "*" *-- "1" Patient : treats
Therapist "1" *-- "*" Prescription : has

class Contact{
    String phone
    String email
    String street
    String city
    String country
}

class Intake{
    ZoneDateTime time
    Prescription prescription
}

Intake "1" --* "*" Prescription : pertains to

class Reminder{
    Prescription prescription
    ZonedDateTime notificationTime
    List<ZonedDateTime> deferTimes
}

Reminder "*" --* "1" Prescription : belongs to

class MoodDiary{
    Patient patient
    List<Entry>
}

Patient "1" *-- "1" MoodDiary : has
MoodDiary "1" *-- "*" Entry : contains
Entry "1" *-- "*" Activity : contains

class Entry{
    LocalDate date
    int mood
    double sleepHours
    double waterDrunk
    List<Activity> medication
    List<Activity> foods
    List<Activity> moodChanges
    List<Activity> exercises
    String notes
}

class Activity{
    LocalTime time
    String text
}

class Dose{
    Unit unit
    int amount
}

Dose "1" *-- "1" Unit : has

enum Unit{
    String name
    String shorthand
}

class Medication{
    String name
    int EAN
}

class Prescription{
    Patient patient
    Therapist therapist
    Medication medication
    Dose dose
    LocalDate issueDate
    LocalDate validFrom
    LocalDate validUntil
    List<Recurrence> recurrences
    ZoneDateTime firstIntake
}

Prescription "1" --- "1" Medication : has
Prescription "1" --- "1" Dose : has
Prescription "1" --- "*" Recurrence : recurs every


interface Recurrence{
    calculateNext(Reminder) : Reminder
    toDisplayString(): String
}

class WeekdayRecurrence implements Recurrence
class EveryTimeUnitRecurrence<U> implements Recurrence

class Channel{
    String name
    List<Person> persons
    List<Message> messages
}

Channel "1" *-- "*" Message : contains
Person "1" *-- "*" Channel : member of

class Message{
    ZonedDateTime timestamp
    Person author
    String text
}

Person "1" *-- "*" Message : authored

@enduml
